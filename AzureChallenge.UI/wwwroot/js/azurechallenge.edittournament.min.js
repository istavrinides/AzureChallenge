var previousSelectedValue=-1,populateModal;$(document).ready(function(){$.validator.setDefaults({ignore:""});$('[data-toggle="tooltip"]').tooltip();$("#questionsSelector").on("changed.bs.select",function(){$("#btnAddToList").removeAttr("disabled")});$("#btnAddToList").on("click",function(){$("#uriTab").empty();$("#uriTabContent").empty();$("#answerTab").empty();$("#answerTabContent").empty();$("#requiredInputsText").text("");$("#requiredInputsUri").text("");$("#requiredInputsAnswer").text("");var i=$("#questionsSelector").val(),t=$("#questionsSelector")[0].selectedOptions[0].attributes[0].nodeValue,n=$("#Id").val();$.get("/Administration/Questions/"+t+"/Get").done(function(t){$("#QuestionToAdd_Text").val(t.text);$("#QuestionToAdd_AssociatedQuestionId").val(t.id);$("#QuestionToAdd_Name").val(t.name);$("#QuestionToAdd_TargettedAzureService").val(t.targettedAzureService);$("#QuestionToAdd_Difficulty").val(t.difficulty);$("#QuestionToAdd_Description").val(t.description);$("#QuestionToAdd_TournamentId").val(n);$("#QuestionToAdd_Justification").val(t.justification);$(".modal-hidden-urls").remove();for(var i=0;i<t.usefulLinks.length;i++)$("#hiddenParamGroup").append("<input type='hidden' class='modal-hidden modal-hidden-urls' name='QuestionToAdd.UsefulLinks["+i+"]' id='QuestionToAdd_UsefulLinks_"+i+"_' value='"+t.usefulLinks[i]+"' />");$.get("/Administration/Tournament/"+n+"/GlobalParameters/Get").done(function(n){var u,i,f,r,c;$("#modalWaiting").hide();var s=0,h=0,l=0,e=!1,o="";if(n){for($("#modalContent").removeClass("d-none"),$(".modal-footer").removeClass("d-none"),u=$("#textParamsInputGroup"),u.empty(),i=0;i<t.textParameters.length;i++)u.append("<div class='form-group col-6'>                                                     <label>"+t.textParameters[i]+"<\/label>                                                     <input type='hidden' name='QuestionToAdd.TextParameters["+i+"].Key' id='QuestionToAdd_TextParameters_"+i+"__Key' value='"+t.textParameters[i]+"' />                                                   <\/div>"),n.parameters&&n.parameters.forEach(function(n){if(n.key===t.textParameters[i]){e=!0;o=n.value;return}}),e?u.append("<div class='form-group col-6'> "+o+"                                                     <\/div>"):t.textParameters[i].startsWith("Profile.")?(c=$("#CurrentUserProfile_"+t.textParameters[i].substr(8)).val(),u.append("<div class='form-group col-6'>"+c+"                                                             <span class='badge badge-warning' data-toggle='tooltip' data-placement='top' title='This is your value. Each user will automatically get their own based on their profile'>(note)<\/span>                                                           <\/div>")):(u.append("<div class='form-group col-6'>                                                         <input class='form-control' name='QuestionToAdd.TextParameters["+i+"].Value' id='QuestionToAdd_TextParameters_"+i+"__Value' required />                                                     <\/div>"),s+=1),e=!1,o="";for(s>0&&$("#requiredInputsText").text(s),u=$("#uriTab"),i=0;i<t.uris.length;i++){for(u.append("<li class='nav-item'>                                         <a class='nav-link uriNavItem' id='uri-"+i+"-tab' data-toggle='tab' href='#uri-"+i+"-content' role='tab' aria-controls='uri-"+i+"-content' aria-selected='false' data-index='"+i+"'> Uri #"+(i+1)+"<\/a>                                     <\/li>"),f="<div class='tab-pane fade' id='uri-"+i+"-content' role='tabpanel' aria-labelledby='uri"+i+"-tab'>                                                     <input type='hidden' name='QuestionToAdd.Uris["+i+"].Id' id='QuestionToAdd_Uris_"+i+"__Id' value='"+t.uris[i].id+"' />                                                     <div class='input-group mb-3'>                                                         <div class= 'input-group-prepend btn-group-toggle' data - toggle='buttons' >                                                             <span class='input-group-text'>"+t.uris[i].callType+"<\/span>                                                             <input type='hidden' name='QuestionToAdd.Uris["+i+"].CallType' id='QuestionToAdd_Uris_"+i+"__CallType' value='"+t.uris[i].callType+"' />                                                         <\/div>                                                         <input name='QuestionToAdd.Uris["+i+"].Uri' id='QuestionToAdd_Uris_"+i+"__Uri' data-index='"+i+"' class='form-control' value='"+t.uris[i].uri+"' readonly />                                                     <\/div >                                                     <br />                                                     <div class='form-group row'>",r=0;r<t.uris[i].uriParameters.length;r++)f+="<div class='form-group col-6'>                                                     <label>"+t.uris[i].uriParameters[r]+"<\/label>                                                     <input type='hidden' name='QuestionToAdd.Uris["+i+"].UriParameters["+r+"].Key' id='QuestionToAdd_Uris_"+i+"__UriParameters_"+r+"__Key' value='"+t.uris[i].uriParameters[r]+"' />                                                  <\/div>",n.parameters&&n.parameters.forEach(function(n){if(n.key===t.uris[i].uriParameters[r]){e=!0;o=n.value;return}}),e?f+="<div class='form-group col-6'> "+o+"                                                      <\/div>":t.uris[i].uriParameters[r].startsWith("Profile.")?(c=$("#CurrentUserProfile_"+t.uris[i].uriParameters[r].substr(8)).val(),f+="<div class='form-group col-6'>"+c+" <span class='badge badge-warning' data-toggle='tooltip' data-placement='top' title='This is your value. Each user will automatically get their own based on their profile'>(note)<\/span><\/div>"):(f+="<div class='form-group col-6'>                                                             <input class='form-control' name='QuestionToAdd.Uris["+i+"].UriParameters["+r+"].Value' id='QuestionToAdd_Uris_"+i+"__UriParameters_"+r+"__Value' required />                                                          <\/div>",h+=1),e=!1,o="";f+="       <\/div>                                                 <\/div>";$("#uriTabContent").append(f);$("#answerTab").append("<li class='nav-item'>                                         <a class='nav-link answerNavItem' id='answer-"+i+"-tab' data-toggle='tab' href='#answer-"+i+"-content' role='tab' aria-controls='answer-"+i+"-content' aria-selected='false'>Answer for Uri #"+(i+1)+"<\/a>                                     <\/li>");$("#answerTabContent").append("<div class='tab-pane fade' id='answer-"+i+"-content' role='tabpanel' aria-labelledby='answer-"+i+"-tab'>                                         <input type='hidden' name='QuestionToAdd.Answers["+i+"].AssociatedUriId' id='QuestionToAdd_Answers_"+i+"__AssociatedUriId' value='"+i+"' />                                         <div class= 'form-group input-group mb-3'>                                             <div class='col-5 pl-0'>                                                 <label class='pr-3'>Answer will be checked against:<\/label>                                             <\/div>                                             <div class='col-4'>                                                 <div class='custom-radio'>                                                     <label class='pr-4'>                                                         <input type='radio' name='QuestionToAdd.Answers["+i+"].ResponseType' id='QuestionToAdd_Answers_"+i+"__ResponseType' value='BODY' id='respBODY' autocomplete='off' checked> Body                                                     <\/label>                                                 <\/div>                                             <\/div>                                             <div class='col-3 text-right pr-0'>                                                 <button type='button' class='btn btn-info addAnswerParameter' data-index='"+i+"'>Add parameter<\/button>                                             <\/div>                                         <\/div>                                         <div id='Answers_"+i+"__params' class='form-group row'>                                         <\/div >                                     <\/div>")}h>0&&$("#requiredInputsUri").text(h);l>0&&$("#requiredInputsAnswer").text(l);s+h+l>0&&$("#btnModalSave").addClass("d-none");$("#uri-0-tab").trigger("click");$("#answer-0-tab").trigger("click")}else $("#modalError").removeClass("d-none"),$(".modal-footer").removeClass("d-none"),$("#btnModalSave").addClass("d-none")})})});$("#btnSave").on("click",function(){$.post("/Administration/Tournament/UpdateTournament",$("form").serialize()).done(function(){$("#updateModal").hide();$("body").removeClass("modal-open");$(".modal-backdrop").remove();$("#btnSave").prop("disabled","disabled");$("#saveAlert").addClass("d-none")}).fail(function(){window.alert("Could not update the tournament, an internal error occured. Please try again later.");location.reload()})});$("#associatedQuestionsTable .indexSelector").on("focus",function(){previousSelectedValue=parseInt($(this).val())}).change(function(){var f,r,n,t,e,u,o,i;if(previousSelectedValue>=0){if($("#btnSave").removeAttr("disabled"),$("#saveAlert").removeClass("d-none"),f=parseInt($(this).val()),r=$(".indexSelector option[value='"+f+"']:selected").parent().not(this),$(r).val(previousSelectedValue),previousSelectedValue<f?(n=$(this).closest("tr"),t=$(r).closest("tr")):(n=$(r).closest("tr"),t=$(this).closest("tr")),e=$(n).find(".nextQuestionId").val(),u=$(t).find(".nextQuestionId").val(),$(n).next("tr").is($(t)))$(n).insertAfter($(t)),$(n).find(".nextQuestionId").val(u),$(t).find(".nextQuestionId").val($(n).find(".questionId").val());else if($(n).prev("tr").length===0){var s=$(n).prev("tr"),i=$(t).prev("tr"),h=$(t).next("tr");$(t).insertBefore($(n));$(n).insertAfter($(i));$(t).find(".nextQuestionId").val(e);$(i).find(".nextQuestionId").val($(n).find(".questionId").val());$(n).find(".nextQuestionId").val(u)}else o=$(n).prev("tr"),i=$(t).prev("tr"),$(t).insertAfter($(o)),$(n).insertAfter($(i)),$(t).find(".nextQuestionId").val(e),$(i).find(".nextQuestionId").val($(n).find(".questionId").val()),$(n).find(".nextQuestionId").val(u),$(o).find(".nextQuestionId").val($(t).find(".questionId").val());previousSelectedValue=-1}});$("#associatedQuestionsTable .tableLinkEdit").on("click",function(){var n=$(this).attr("data-questionId"),t=$("#Id").val();populateModal(n,t,!1)});$("#associatedQuestionsTable .tableLinkDetails").on("click",function(){var n=$(this).attr("data-questionId"),t=$("#Id").val();populateModal(n,t,!0)});$("#associatedQuestionsTable .tableLinkCheck").on("click",function(){var n=$(this).attr("data-questionId");$("#checkModalContentDiv").empty();$.get("/Administration/Tournament/ValidateQuestion?questionId="+n).done(function(n){$("#checkModalWaiting").hide();$("#checkModalContent").removeClass("d-none");n.forEach(function(n){$("#checkModalContentDiv").append("<div class='col-md-6'>"+n.Key+"<\/div><div class='col-md-6'>"+(n.Value?"<span class='text-success'>Success<\/span>":"<span class='text-danger'>Failure<\/span>")+"<\/div>")})}).fail(function(){window.alert("Could not validate the question, an internal error occured. Please try again later.");$("#checkModal").hide();$("body").removeClass("modal-open");$(".modal-backdrop").remove()})});$("#associatedQuestionsTable .deleteAssociatedQuestion").on("click",function(){var n=$(this).attr("data-questionId"),t=$("#Id").val();$.get("/Administration/Tournament/RemoveQuestion?questionId="+n+"&tournamentId="+t).done(function(){location.reload()}).fail(function(){window.alert("Could not delete the question, an internal error occured. Please try again later.")})});$("#answersParamsGroup").on("click",".addAnswerParameter",function(){var t=parseInt($(this).data("index")),n=-1,i,r;return $("#Answers_"+t+"__params input.answerParamInputKey").each(function(){thisIndex=parseInt($(this).data("index"));n<thisIndex&&(n=thisIndex)}),n===-1?n=0:n+=1,i=$("#Answers_"+t+"__params"),i.append("<div class='form-group col-4'>                             <label>Path<\/label>                             <input class='form-control answerParamInput answerParamInputKey' name='QuestionToAdd.Answers["+t+"].AnswerParameters["+n+"].Key' id='QuestionToAdd_Answers_"+t+"_AnswerParameters_"+n+"__Key'' data-index='"+n+"' required /><\/div>"),i.append("<div class='form-group col-4'>                             <label>Value to check<\/label>                             <input class='form-control answerParamInput answerParamInputVal' name='QuestionToAdd.Answers["+t+"].AnswerParameters["+n+"].Value' id='QuestionToAdd_Answers_"+t+"_AnswerParameters_"+n+"__Value' data-index='"+n+"' required /><\/div>"),i.append("<div class='form-group col-4'>                             <label>Error Message<\/label>                             <input class='form-control answerParamInput answerParamInputError' name='QuestionToAdd.Answers["+t+"].AnswerParameters["+n+"].ErrorMessage' id='QuestionToAdd_Answers_"+t+"_AnswerParameters_"+n+"__ErrorMessage' data-index='"+n+"' required /><\/div>"),r=0,parseInt($("#requiredInputsAnswer").text())&&(r=parseInt($("#requiredInputsAnswer").text())),$("#requiredInputsAnswer").text(r+2),!1});$("#questionModal").on("hidden.bs.modal",function(){$("#modalWaiting").show();$("#modalContent").addClass("d-none");$("#modalError").addClass("d-none");$(".modal-footer").addClass("d-none");$("#btnModalSave").removeAttr("disabled");$("#btnModalSave").show()});$("#checkModal").on("hidden.bs.modal",function(){$("#checkModalWaiting").show();$("#checkModalContent").addClass("d-none")});$(".tab-pane").on("input","input",function(){var n=$(this).closest(".tab-pane-upper").attr("id"),t=$("#modalTabs a.nav-link[aria-controls='"+n+"'] span"),i=$("#"+n+" input:not(.modal-hidden)").filter(function(){return!$(this).val()}).length,r;i>0?$(t).text(i):$(t).text("");r=$("#modalTabsContent input:not(.modal-hidden)").filter(function(){return!$(this).val()}).length;r===0?$("#btnModalSave").removeClass("d-none"):$("#btnModalSave").addClass("d-none")})});populateModal=function(n,t,i=false){$("#uriTab").empty();$("#uriTabContent").empty();$("#answerTab").empty();$("#answerTabContent").empty();$("#requiredInputsText").text("");$("#requiredInputsUri").text("");$("#requiredInputsAnswer").text("");$.get("/Administration/Tournament/"+t+"/AssignedQuestion/"+n).done(function(n){$("#QuestionToAdd_Text").val(n.text);$("#QuestionToAdd_AssociatedQuestionId").val(n.id);$("#QuestionToAdd_Name").val(n.name);$("#QuestionToAdd_TargettedAzureService").val(n.targettedAzureService);$("#QuestionToAdd_Difficulty").val(n.difficulty);$("#QuestionToAdd_Description").val(n.description);$("#QuestionToAdd_TournamentId").val(t);$("#QuestionToAdd_Id").val(n.id);$("#QuestionToAdd_Justification").val(n.justification);$(".modal-hidden-urls").remove();for(var r=0;r<n.usefulLinks.length;r++)$("#hiddenParamGroup").append("<input type='hidden' class='modal-hidden modal-hidden-urls' name='QuestionToAdd.UsefulLinks["+r+"]' id='QuestionToAdd_UsefulLinks_"+r+"_' value='"+n.usefulLinks[r]+"' />");$.get("/Administration/Tournament/"+t+"/GlobalParameters/Get").done(function(t){var e,r,f,u,o;for($("#modalWaiting").hide(),$("#modalContent").removeClass("d-none"),$(".modal-footer").removeClass("d-none"),i&&($("#btnModalSave").prop("disabled","disabled"),$("#btnModalSave").hide()),e=$("#textParamsInputGroup"),e.empty(),r=0;r<n.textParameters.length;r++)e.append("<div class='form-group col-6'>                                             <label>"+n.textParameters[r].key+"<\/label>                                             <input type='hidden' name='QuestionToAdd.TextParameters["+r+"].Key' id='QuestionToAdd_TextParameters_"+r+"__Key' value='"+n.textParameters[r].key+"' />                                           <\/div>"),t.parameters.some(t=>t.key===n.textParameters[r].key)?e.append("<div class='form-group col-6'> "+t.parameters.find(t=>t.key===n.textParameters[r].key).value+"                                                     <\/div>"):n.textParameters[r].key.startsWith("Profile.")?(o=$("#CurrentUserProfile_"+n.textParameters[r].key.substr(8)).val(),e.append("<div class='form-group col-6'>"+o+" <span class='badge badge-warning' data-toggle='tooltip' data-placement='top' title='This is your value. Each user will automatically get their own based on their profile'>(note)<\/span><\/div>")):e.append("<div class='form-group col-6'>                                                 <input class='form-control' name='QuestionToAdd.TextParameters["+r+"].Value' id='QuestionToAdd_TextParameters_"+r+"__Value' required value='"+n.textParameters[r].value+"' />                                             <\/div>");for(e=$("#uriTab"),r=0;r<n.uris.length;r++){for(e.append("<li class='nav-item'>                                         <a class='nav-link uriNavItem' id='uri-"+r+"-tab' data-toggle='tab' href='#uri-"+r+"-content' role='tab' aria-controls='uri-"+r+"-content' aria-selected='false' data-index='"+r+"'> Uri #"+(r+1)+"<\/a>                                     <\/li>"),f="<div class='tab-pane fade' id='uri-"+r+"-content' role='tabpanel' aria-labelledby='uri"+r+"-tab'>                                                     <input type='hidden' name='QuestionToAdd.Uris["+r+"].Id' id='QuestionToAdd_Uris_"+r+"__Id' value='"+n.uris[r].id+"' />                                                     <div class='input-group mb-3'>                                                         <div class= 'input-group-prepend btn-group-toggle' data - toggle='buttons' >                                                             <span class='input-group-text'>"+n.uris[r].callType+"<\/span>                                                             <input type='hidden' name='QuestionToAdd.Uris["+r+"].CallType' id='QuestionToAdd_Uris_"+r+"__CallType' value='"+n.uris[r].callType+"' />                                                         <\/div>                                                         <input name='QuestionToAdd.Uris["+r+"].Uri' id='QuestionToAdd_Uris_"+r+"__Uri' data-index='"+r+"' class='form-control' value='"+n.uris[r].uri+"' readonly />                                                     <\/div >                                                     <br />                                                     <div class='form-group row'>",u=0;u<n.uris[r].uriParameters.length;u++)f+="<div class='form-group col-6'>                                                     <label>"+n.uris[r].uriParameters[u].key+"<\/label>                                                     <input type='hidden' name='QuestionToAdd.Uris["+r+"].UriParameters["+u+"].Key' id='QuestionToAdd_Uris_"+r+"__UriParameters_"+u+"__Key' value='"+n.uris[r].uriParameters[u].key+"' />                                                  <\/div>",t.parameters.some(t=>t.key===n.uris[r].uriParameters[u].key)?f+="<div class='form-group col-6'> "+t.parameters.find(t=>t.key===n.uris[r].uriParameters[u].key).value+"                                             <input type='hidden' name='QuestionToAdd.Uris["+r+"].UriParameters["+u+"].Value' id='QuestionToAdd_Uris_"+r+"__UriParameters_"+u+"__Key' value='"+n.uris[r].uriParameters[u].value+"' />                                             <\/div>":n.uris[r].uriParameters[u].key.startsWith("Profile.")?(o=$("#CurrentUserProfile_"+n.uris[r].uriParameters[u].key.substr(8)).val(),f+="<div class='form-group col-6'>"+o+" <span class='badge badge-warning' data-toggle='tooltip' data-placement='top' title='This is your value. Each user will automatically get their own based on their profile'>(note)<\/span><\/div>"):f+="<div class='form-group col-6'>                                                 <input class='form-control' name='QuestionToAdd.Uris["+r+"].UriParameters["+u+"].Value' id='QuestionToAdd_Uris_"+r+"__UriParameters_"+u+"__Value' required value='"+n.uris[r].uriParameters[u].value+"'/>                                             <\/div>";for(f+="       <\/div>                                                 <\/div>",$("#uriTabContent").append(f),$("#answerTab").append("<li class='nav-item'>                                         <a class='nav-link answerNavItem' id='answer-"+r+"-tab' data-toggle='tab' href='#answer-"+r+"-content' role='tab' aria-controls='answer-"+r+"-content' aria-selected='false'>Answer for Uri #"+(r+1)+"<\/a>                                     <\/li>"),f="",u=0;u<n.answers[r].answerParameters.length;u++)f+="<div class='form-group col-4'>                                             <label>Path<\/label>                                         <input class='form-control answerParamInput answerParamInputKey' name='QuestionToAdd.Answers["+r+"].AnswerParameters["+u+"].Key' id='QuestionToAdd_Answers_"+r+"_AnswerParameters_"+u+"__Key' data-index='"+u+"' required "+(i?"readonly":"")+" /><\/div>",f+="<div class='form-group col-4'>                                             <label>Value to check<\/label>                                         <input class='form-control answerParamInput answerParamInputVal' name='QuestionToAdd.Answers["+r+"].AnswerParameters["+u+"].Value' id='QuestionToAdd_Answers_"+r+"_AnswerParameters_"+u+"__Value' data-index='"+u+"' required "+(i?"readonly":"")+" /><\/div>",f+="<div class='form-group col-4'>                                             <label>Error Message<\/label>                                         <input class='form-control answerParamInput answerParamInputError' name='QuestionToAdd.Answers["+r+"].AnswerParameters["+u+"].ErrorMessage' id='QuestionToAdd_Answers_"+r+"_AnswerParameters_"+u+"__ErrorMessage' data-index='"+u+"' required "+(i?"readonly":"")+" /><\/div>";for($("#answerTabContent").append("<div class='tab-pane fade' id='answer-"+r+"-content' role='tabpanel' aria-labelledby='answer-"+r+"-tab'>                                 <input type='hidden' name='QuestionToAdd.Answers["+r+"].AssociatedUriId' id='QuestionToAdd_Answers_"+r+"__AssociatedUriId' value='"+r+"' />                                 <div class= 'form-group input-group mb-3'>                                     <div class='col-5 pl-0'>                                         <label class='pr-3'>Answer will be checked against:<\/label>                                     <\/div>                                     <div class='col-4'>                                         <div class='custom-radio'>                                             <label class='pr-4'>                                                 <input type='radio' name='QuestionToAdd.Answers["+r+"].ResponseType' id='QuestionToAdd_Answers_"+r+"__ResponseType' value='BODY' id='respBODY' autocomplete='off' "+(n.answers[r].responseType==="BODY"?"checked":"")+" "+(i?"disabled":"")+"> Body                                             <\/label>                                         <\/div>                                     <\/div>                                     <div class='col-3 text-right pr-0'>                                         "+(i?"":"<button type='button' class='btn btn-info addAnswerParameter' data-index='"+r+"'>Add parameter<\/button>")+"                                     <\/div>                                 <\/div>                                 <div id='Answers_"+r+"__params' class='form-group row'>"+f+"<\/div>                             <\/div>"),u=0;u<n.answers[r].answerParameters.length;u++)$("#QuestionToAdd_Answers_"+r+"_AnswerParameters_"+u+"__Key").val(n.answers[r].answerParameters[u].key),$("#QuestionToAdd_Answers_"+r+"_AnswerParameters_"+u+"__Value").val(n.answers[r].answerParameters[u].value),$("#QuestionToAdd_Answers_"+r+"_AnswerParameters_"+u+"__ErrorMessage").val(n.answers[r].answerParameters[u].errorMessage)}$("#uri-0-tab").trigger("click");$("#answer-0-tab").trigger("click")})}).fail(function(){$("#modalError").removeClass("d-none");$(".modal-footer").removeClass("d-none");$("#btnModalSave").addClass("d-none")})};